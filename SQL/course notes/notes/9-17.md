

# 查询语言与关系代数（Query Languages for Relational DB）

## 数据库操作（Operations on DB）
1. **queries**：从数据库读取数据 (**查询**)  
2. **updates**：修改数据库内容 (**更新**)  

- **Formal query language（形式化查询语言）**：**Relational Algebra（关系代数）**  
- **Relational algebra** 是一种 **过程化语言 (procedural language)**：  
  查询由 **运算符 (operators)** 应用于 **关系 (relations)** 构成代数表达式，表示得到结果的步骤。  
- 后续会学习 **SQL**：一种用于查询和更新的实用语言。  

---

## 关系代数（Relational Algebra）

### 五种基本操作（5 basic operations）
1. **Union（并集）**  
2. **Difference（差集）**  
3. **Cartesian Product（笛卡尔积）**  
4. **Projection（投影）**  
5. **Selection（选择）**  

- 这五种操作 **完全定义** 了关系代数。  
- **每个操作的结果仍然是关系**（闭包性质 closure property）。  
- 还有一些 **派生操作（derived operations）**，由基本操作组合而成，不增加表达能力，但更方便。  
  - 最重要的派生操作：**Join（连接）**  
  - **Renaming（重命名）**：修改属性名。  

---

## 并集（Union）
- **R ∪ S**：属于 R 或 S 或同时属于两者的元组集合。  
- 前提：R 和 S **度（degree）相同**，且对应属性 **类型兼容**。  
- 如果属性名不同，结果关系默认采用 **R 的属性名**（除非重命名）。  
- **去重**：重复元组被消除。  
- 返回关系的度与原关系相同。  

---

## 差集（Difference）
- **R − S**：在 R 中但不在 S 中的元组集合。  
- 条件与并集相同：度相同，属性兼容。  
- 返回关系的度与原关系相同。  

---

## 笛卡尔积（Cartesian Product）
- **R × S**：如果 R 的度为 k1，S 的度为 k2，则结果关系度为 k1+k2。  
- 每个元组前 k1 个分量来自 R，后 k2 个分量来自 S。  
- 属性命名：前 k1 个为 R 的属性名，后 k2 个为 S 的属性名。  
- 对两表的属性和度没有任何要求，如果有同名属性，必须进行 **重命名**。 

---

## 投影（Projection = 垂直分解）
- **πA1,A2,...,Am(R)**：返回只包含指定属性子集 {A1...Am} 的关系。  
- 结果关系的度为 m。  
- 按指定顺序排列属性。  

---

## 选择（Selection = 水平分解）
- **σF(R)**：在关系 R 上选择满足谓词 F 的元组。  
- 谓词 F 可以是：  
  - 简单谓词：  
    - A op 常量  
    - A op A'（两个属性比较）  
  - 布尔组合：  
    - AND (∧)、OR (∨)、NOT (¬)  
- 返回关系的度与原关系相同。  
- 若无元组满足，返回空关系（∅）。  

---

## 重命名（Renaming）
- **ρA1,…,Am ← B1,…,Bm(R)**：将 R 中属性 Ai 重命名为 Bi。  
- 用途：解决属性重名问题。  
- 例子：  
  - R(Name, Surname, City)，S(Code, Name)  
  - 笛卡尔积前必须重命名：  
    - ρ(Name ← StudentName)(R) × S  
  - 结果模式： (StudentName, Surname, City, Code, Name)  

---

## 例子（Examples）

- **Q1**：查找工资大于 2000 的员工姓名  
  ```text
  πName(σSalary > 2000(EMPLOYEES))
````

* **Q2**：查找工资大于 2000 且职位为 engineer 的员工姓名和部门号

  ```text
  πName,Dept#(σSalary > 2000 ∧ Job='engineer'(EMPLOYEES))
  ```

* **Q3**：查找在部门 30 且职位为 engineer 或 technician 的员工编号

  ```text
  πEmp#(σDept#=30 ∧ (Job='engineer' ∨ Job='technician')(EMPLOYEES))
  ```

---

## 📘 关键字中英对照

| 英文                  | 中文       |
| ------------------- | -------- |
| Query Language      | 查询语言     |
| Relational Algebra  | 关系代数     |
| Procedural Language | 过程化语言    |
| Relation            | 关系       |
| Tuple               | 元组       |
| Attribute           | 属性       |
| Domain              | 域        |
| Schema              | 模式       |
| Union               | 并集       |
| Difference          | 差集       |
| Cartesian Product   | 笛卡尔积     |
| Projection          | 投影（垂直分解） |
| Selection           | 选择（水平分解） |
| Predicate           | 谓词       |
| Join                | 连接       |
| Renaming            | 重命名      |
| Closure Property    | 闭包性质     |
| Derived Operation   | 派生操作     |

```

